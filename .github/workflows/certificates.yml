name: Certificates check ðŸ”

on:
  schedule:
    - cron: '0 3 * * 1,3,5'

  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  certificates:
    name: '${{ matrix.sites.domain }} certificate is valid more than ${{ matrix.sites.days }} days'
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        sites:
          - domain: kristofer.palmvik.se
            days: 25
          - domain: www.hemnet.se
            days: 25
          - domain: www.google.com
            days: 10
          - domain: www.sydsvenskan.se
            days: 25
          - domain: www.testfreaks.com
            days: 15
          - domain: www.na.se
            days: 25
          - domain: www.positiongreen.com
            days: 25
          - domain: trustvoice.com
            days: 25
          - domain: univid.io
            days: 25
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-node@v6
        with:
          cache: 'npm'
          node-version: lts/*
      - name: Install dependencies
        run: npm ci
      - name: ${{ matrix.sites.domain }} certificate check
        run: |
          if OUTPUT=$(npm run --silent check-cert ${{ matrix.sites.domain }} ${{ matrix.sites.days }} 2>&1); then
            echo "- âœ… $OUTPUT" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ ${{ matrix.sites.domain }}: $OUTPUT" >> $GITHUB_STEP_SUMMARY
            exit 1
          fi
